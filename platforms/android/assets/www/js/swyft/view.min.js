var sView={utils:{alert:function(g,f,d,c){var a=(typeof d==="undefined")?d:"Ok",b=(typeof f==="undefined")?"Notification":f,e=(g!==null||g!=="")?g:"Alert";if(sController.app.events.params.pg===true){navigator.notification.alert(e,c,b,a)}else{alertify.set({labels:{ok:a}});alertify.alert(e);c()}},prompt:function(i,h,d,a,f,c){var g=(d!==false&&d!==null)?d:"Ok",j=(a!==false&&a!==null)?d:"Cancel",e=(f!==false&&f!==null)?f:"",b=(h!==false&&h!==null)?h:"Notification",k=null;if(sModel.me.platform==="iOS"){if((sController.app.events.params.pg===true)){k=[g,j]}}else{if(sModel.me.platform==="Android"){if((sController.app.events.params.pg===true)){k=[j,g]}}}if(sController.app.events.params.pg===true){navigator.notification.prompt(i,c,b,k,e)}else{alertify.set({labels:{ok:g,cancel:j}});alertify.prompt(i,function(l,m){if(l){c(true,m)}else{c(false,m)}},e)}},confirm:function(h,g,e,a,c){var f=(typeof e!=="undefined"||e!==false)?e:"Ok",i=(typeof a!=="undefined"||a!==false)?a:"Cancel",b=(typeof g!=="undefined"||g!==false)?g:"Notification",d=(typeof c==="function")?c:false;if(d===false){return}else{if(sController.app.events.params.pg===true){navigator.notification.confirm(h,d,b,[f,i])}else{alertify.set({labels:{ok:f,cancel:i}});alertify.confirm(h,function(j){if(j){d(2)}else{d(1)}})}}}},helpers:{wideScreen:function(){return(window.innerWidth>1200)}},jqm:{helpers:{pid:function(){return $("body").pagecontainer("getActivePage").attr("id")},ldrWidget:function(b,a){if(typeof a!=="undefined"&&b==="show"){$.mobile.loading(b,{text:a,textVisible:true})}else{if(b==="hide"){$.mobile.loading(b)}}},panelShowHide:function(){if(sView.jqm.helpers.pid()!=="loading"&&sView.jqm.helpers.pid()!=="welcomeSetup"){if(sView.helpers.wideScreen()){$("#mainP").panel("open")}else{$("#mainP").panel("close")}}else{$("#mainP").panel("close")}}},init:function(a){sView.jqm.widgets(function(){sView.jqm.pageActions(function(){if(window.innerWidth>1200){$("mainP").panel("open")}a()})})},widgets:function(a){$(".diTextBox").addClass("textBgColor");$("#mainP").panel({theme:"a",animate:false,display:"reveal",open:function(b,c){$(".ui-panel-wrapper").addClass("ui-panel-page-content-position-left ui-panel-page-content-display-reveal ui-panel-page-content-open")},close:function(b,c){$(".ui-panel-wrapper").removeClass("ui-panel-page-content-position-left ui-panel-page-content-display-reveal ui-panel-page-content-open")}});$("body").on("pagecontainershow",function(b,c){});$("#mainMenu").listview({create:function(b,c){if(typeof a==="function"){a()}}})},pageActions:function(a){$(".btnMainNav").on("tap",function(b){b.preventDefault();$("#mainP").panel("close");sView.changePage($(this).attr("data-swyft-page"))});$(".mainMenu").on("tap",function(b){b.preventDefault();$("#mainP").panel("open");sView.jqm.helpers.ldrWidget("hide")});$(".btnLogin").on("tap",function(b){sController.app.sysEvents.cfgCheck()});$(".btnBack").on("tap",function(b){window.history.back()});$(".btnFactoryReset").on("tap",function(b){sController.app.sysEvents.resetApp()});$(".googleInApp").on("tap",function(b){b.preventDefault();$("#mainP").panel("close");sView.openInapp("https://www.google.com/",true,false)});$(".swyftUserVoiceInApp").on("tap",function(b){b.preventDefault();$("#mainP").panel("close");sView.openInapp("https://swyft.uservoice.com/",true,false)});$("#btnInitDevice").on("tap",function(b){sController.app.sysEvents.sInit.start()});$(".clearEntries").on("tap",function(b){sController.forms.clear($(this).attr("data-swyft-form"))});$(".btnUpdatePos").on("tap",function(b){b.preventDefault();sModel.setGps(true,true,true,function(){sView.changePage(sView.jqm.helpers.pid())})});$(".btnUpdatePosDiPage").on("tap",function(b){b.preventDefault();sModel.setGps(true,true,true,false)});$("#debugBtn").on("change",function(c){var b=$.Deferred();sView.jqm.helpers.ldrWidget("show","Configuring Debug");b.resolve(this.value);$.when(b).then(function(d){if(d==="true"){sUtil.clog("Debug :: Turn debug on");sView.utils.confirm("About To Start Debug Mode.\nThis will give Swyft the \nability to read diagnostic messages remotely.","Notification","Go Ahead","No Stop",function(f){var e=(sModel.me.devicePlatform==="Android")?1:2;if(f===e){sController.debug.setStatus(true,function(g){setTimeout(function(){location.reload()},500);$("#debugId").html(g)})}else{sView.jqm.helpers.ldrWidget("hide");$("#debugId").html("").attr("checked","").checkboxradio("refresh")}})}else{if(d==="false"){sUtil.clog("Debug :: Turn debug off");$("#debugId").html("").attr("checked","").checkboxradio("refresh");sController.debug.setStatus(false)}else{sUtil.clog("Debug :: cbVal is "+d)}}})});$(window).resize(function(){sView.jqm.helpers.panelShowHide();var b=(sModel.me.platform==="iOS")?64:48;$("#"+sView.jqm.helpers.pid()+" iframe").css("height",(window.innerHeight-b)).css("min-height",(window.innerHeight-b)).css("max-height",(window.innerHeight-b))});$("body").on("pagecontainerhide",function(){if($("body").pagecontainer("getActivePage").hasClass("iframePage")){var c=sView.getPageTitle(sView.jqm.helpers.pid()),b=(c!==false)?"Loading "+c:"Loading";sView.jqm.helpers.ldrWidget("show",b)}});$("body").on("pagecontainerload",function(){if($("body").pagecontainer("getActivePage").hasClass("iframePage")){var b=(sModel.me.platform==="iOS")?64:48;$("#"+sView.jqm.helpers.pid()+"Iframe").css("height",(window.innerHeight-b)).css("min-height",(window.innerHeight-b)).css("max-height",(window.innerHeight-b))}});if(typeof a==="function"){a()}}},socket:null,changePage:function(a){$(".loadingCover").addClass("cssBlock").removeClass("cssHide");this.nav(a,function(d,c){sUtil.clog("The target is "+d+" The type is "+c);if(c==="change"){$("body").pagecontainer("change",d)}else{if(c==="refresh"){var b=(sModel.me.platform==="iOS")?64:48;$(d+"Iframe").css("height",(window.innerHeight-b)).css("min-height",(window.innerHeight-b)).css("max-height",(window.innerHeight-b))}}})},nav:function(c,d){var a=sView.jqm.helpers.pid(),b=(a===c)?sView.getPageTitle(a):sView.getPageTitle(c);if(typeof b==="undefined"||b===null){b=""}if($("#"+c).hasClass("iframePage")){if(a===c){sView.jqm.helpers.ldrWidget("show","Refreshing "+b);this.update(a,c,"refresh",function(e){d(e,"refresh")})}else{sView.jqm.helpers.ldrWidget("show","Loading "+b);this.update(a,c,"change",function(e){d(e,"change")})}}else{d("#"+c,"change")}},update:function(c,b,d,f){var a=(sModel.me.platform==="iOS")?64:48;function e(g){if(c==="dash"){}f("#"+g)}if(d==="refresh"){this.buildUrl(c,function(h,g){if(sModel.me.devicePlatform==="Desktop"){$("#"+g).empty();sView.socket=new easyXDM.Socket({remote:h,container:document.getElementById(g),onMessage:sController.app.sysEvents.receiveMessage,onReady:function(){e(c+"Iframe")}})}else{$("#"+c+"Iframe").attr("src","").attr("src",h).css("height",(window.innerHeight-a)).css("min-height",(window.innerHeight-a)).css("max-height",(window.innerHeight-a));e(c+"Iframe")}})}else{if(d==="change"){this.buildUrl(b,function(h,g){if(sModel.me.devicePlatform==="Desktop"){$("#"+g).empty();sView.socket=new easyXDM.Socket({remote:h,container:document.getElementById(g),onMessage:sController.app.sysEvents.receiveMessage,onReady:function(){e(b)}})}else{$("#"+b+"Iframe").attr("src","").attr("src",h).css("height",(window.innerHeight-a)).css("min-height",(window.innerHeight-a)).css("max-height",(window.innerHeight-a));e(b)}})}}},buildUrl:function(c,b){var a=null,d=null;switch(c){case"dash":a=sModel.me.mobileSiteUrl+"/FrontDashboard.aspx?deviceid="+sModel.me.deviceUuid+"&appversion="+sModel.me.appVersion+"&currlat="+sModel.me.deviceLat+"&currlng="+sModel.me.deviceLng+"&clientcode="+sModel.me.clientCode+"&userid="+sModel.me.userId+"&platform="+sModel.me.devicePlatform+"&lang="+sModel.me.lang;d="xdmDashFrame";break;case"local":a=sModel.me.mobileSiteUrl+"/ProspectNearMe.aspx?deviceid="+sModel.me.deviceUuid+"&location="+sModel.me.interactionLocation+"&intertype="+sModel.me.interactionType+"&channel="+sModel.me.interactionChannel+"&currlat="+sModel.me.deviceLat+"&currlng="+sModel.me.deviceLng+"&clientcode="+sModel.me.clientCode+"&userid="+sModel.me.userId+"&platform="+sModel.me.devicePlatform+"&lang="+sModel.me.lang;d="xdmLocalFrame";break;case"followUps":a=sModel.me.mobileSiteUrl+"/followUpCalendar.aspx?deviceid="+sModel.me.deviceUuid+"&location="+sModel.me.interactionLocation+"&intertype="+sModel.me.interactionType+"&channel="+sModel.me.interactionChannel+"&action=followup&currlat="+sModel.me.deviceLat+"&currlng="+sModel.me.deviceLng+"&clientcode="+sModel.me.clientCode+"&userid="+sModel.me.userId+"&platform="+sModel.me.devicePlatform+"&lang="+sModel.me.lang;d="xdmFollowUpFrame";break;case"assignments":a=sModel.me.mobileSiteUrl+"/prospectList.aspx?deviceid="+sModel.me.deviceUuid+"&location="+sModel.me.interactionLocation+"&intertype="+sModel.me.interactionType+"&channel="+sModel.me.interactionChannel+"&action=lead&currlat="+sModel.me.deviceLat+"&currlng="+sModel.me.deviceLng+"&clientcode="+sModel.me.clientCode+"&userid="+sModel.me.userId+"&platform="+sModel.me.devicePlatform+"&lang="+sModel.me.lang;d="xdmAssignmentsFrame";break;case"products":a=sModel.me.mobileSiteUrl+"/ProductList.aspx";d="xdmProductsFrame";break;case"add":a=sModel.me.mobileSiteUrl+"/AddProspect.aspx?deviceid="+sModel.me.deviceUuid+"&location="+sModel.me.interactionLocation+"&intertype="+sModel.me.interactionType+"&channel="+sModel.me.interactionChannel+"&currlat="+sModel.me.deviceLat+"&currlng="+sModel.me.deviceLng+"&clientcode="+sModel.me.clientCode+"&userid="+sModel.me.userId+"&platform="+sModel.me.devicePlatform+"&lang="+sModel.me.lang;d="xdmAddFrame";break;case"search":a=sModel.me.mobileSiteUrl+"/prospectSearch.aspx?deviceid="+sModel.me.deviceUuid+"&location="+sModel.me.interactionLocation+"&intertype="+sModel.me.interactionType+"&channel="+sModel.me.interactionChannel+"&currlat="+sModel.me.deviceLat+"&currlng="+sModel.me.deviceLng+"&clientcode="+sModel.me.clientCode+"&userid="+sModel.me.userId+"&platform="+sModel.me.devicePlatform+"&lang="+sModel.me.lang;d="xdmSearchFrame";break}b(a,d)},openInapp:function(d,g,e){sUtil.clog("In inApp");var b=(g===true)?"location=yes":"location=no",a=(sModel.me.devicePlatform==="iOS")?"comgooglemaps://":(sModel.me.devicePlatform==="Android")?"com.google.android.maps":false,c=(d.search("//maps.google.com/maps")!==-1),f=(typeof d!=="undefined"||typeof d!==null)?d:false;if(e===true&&f!==false){sUtil.clog("Open External URL");if(c){if(a===false){sUtil.clog("Not on Mobile Platform");sView.processInApp(f,true,b)}else{sUtil.clog("On Mobile Platform");window.appAvailability.check(a,function(h){sUtil.clog("Found a Map App");if(h){sUtil.clog("Google Maps is available");if(sModel.me.devicePlatform==="iOS"){f=d.replace("http://maps.google.com/maps",a).replace("https://maps.google.com/maps",a)}sView.processInApp(f,true,b)}else{sUtil.clog("Google Maps is NOT available");sView.processInApp(f,true,b)}})}}else{sView.processInApp(f,true,b)}}else{if(f!==false){sUtil.clog("Open in a inAppBrowser");sView.processInApp(f,false,b)}}},processInApp:function(e,d,a){var c=(typeof d!=="undefined"&&typeof d==="boolean")?(d===true)?"_system":"_blank":"_blank";sUtil.clog("The URL is "+e+" :: External Type: "+c+" :: Show the location bar: "+a);var b=window.open(encodeURI(e),c,a);b.addEventListener("loadstart",function(f){window.StatusBar.hide()});b.addEventListener("loadstop",function(f){sUtil.clog("page loaded","inappbrowser",false)});b.addEventListener("exit",function(f){window.StatusBar.show()});b.addEventListener("loaderror",function(f){sView.utils.alert("Error Loading URL","Notification","I Understand",function(){b.close()})})},getPageTitle:function(a){var b;switch(a){case"dash":b="Dashboard";break;case"local":b="Local Market";break;case"followUps":b="Appointments";break;case"assignments":b="Assignments";break;case"products":b="Info";break;case"search":b="Search";break;case"bcScannerResultsPage":b="Scan Results";break;case"lockPage":b="Lock Page";break;case"add":b="Add Prospect";break;default:b=false;break}return b},makeMap:function(a,c){var b=new Microsoft.Maps.Location(a.coords.latitude,a.coords.longitude);$("#diLattxt").attr("value",a.coords.latitude);$("#diLngtxt").attr("value",a.coords.longitude);$("#diLatlctxt").attr("value",new Date(a.timestamp));$("#app_map_canvas").gmap({credentials:"AqiLW9NFwHvrYcx-qJ9JPo-UMMLGq185rCzNI9nNoLQPQ0LvSsG44z-Ab-Ynuaqe",center:b,zoom:15,disableZooming:true,disablePanning:true,disableTouchInput:true,disableUserInput:true,enableClickableLogo:false,enableSearchLogo:false,fixedMapPosition:false,showCopyright:false,showDashboard:false,showMapTypeSelector:false,showScalebar:false,useInertia:false,mapTypeId:Microsoft.Maps.MapTypeId.road,callback:function(){var d=this;d.addMarker({location:a.coords.latitude+", "+a.coords.longitude,bounds:false})}});if(typeof c==="function"){c("done")}},reDrawMap:function(a,c){sUtil.clog("MAP :: Re-Draw Map :: START");var b=$("#app_map_canvas");$("#diLattxt").attr("value",a.coords.latitude);$("#diLngtxt").attr("value",a.coords.longitude);$("#diLatlctxt").attr("value",new Date(a.timestamp));b.gmap("clear","markers");b.gmap("addMarker",{id:"userCurr",location:a.coords.latitude+", "+a.coords.longitude,bounds:false,zoom:15});sModel.gpsCallbacks.reDraw=false;sUtil.clog("Re-Draw :: Callback");c()}};