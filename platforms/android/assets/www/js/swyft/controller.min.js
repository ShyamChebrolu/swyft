var sController={swyftError:function(a){sUtil.clog("Error :: "+a.message);return false},errorCB:function(a){sUtil.clog("Error processing SQL: "+a.code)},genRandomNum:function(){return Math.floor(Math.random()*90000)+10000},app:{cfg:{usrTblObj:{},globalAppVersion:"2.5.11",states:{}},initialize:function(){sController.app.events.pgCheck(function(){sController.app.events.bind()})},events:{params:{socket:null,spmk:"OUYxQzgwOTktNDY4RC00QTI3LThBRDUtRjJCQUM2MDBEQUQy",pg:false,pgChk:$.Deferred(),jq:$.Deferred(),jqm:$.Deferred(),dReady:$.Deferred()},bind:function(){document.addEventListener("deviceready",sController.app.events.deviceready,false);if(typeof window.jQuery!=="undefined"){if(sController.app.events.params.jq.state()!=="resolved"){sController.app.events.jqReady()}}else{$(document).ready(function(){if(sController.app.events.params.jq.state()!=="resolved"){sController.app.events.jqReady()}})}if(typeof $.mobile!=="undefined"){if(sController.app.events.params.jqm.state()!=="resolved"){sController.app.events.jqmReady()}}else{$(document).on("pagecreate",function(){if(sController.app.events.params.jqm.state()!=="resolved"){sController.app.events.jqmReady()}})}$.when(sController.app.events.params.jq,sController.app.events.params.jqm,sController.app.events.params.pgChk).then(function(){sView.jqm.helpers.ldrWidget("show","Starting Swyft");if(sController.app.events.params.pg===true){$.when(sController.app.events.params.dReady).then(function(){sController.app.sysEvents.cfgCheck()})}else{sController.app.sysEvents.cfgCheck()}})},jqmReady:function(){sView.jqm.init(function(){sController.app.events.params.jqm.resolve()})},jqReady:function(){sController.app.events.params.jq.resolve()},deviceready:function(){sController.app.events.params.pg=true;if(device.platform==="iOS"){window.StatusBar.overlaysWebView(false);window.StatusBar.styleLightContent();window.StatusBar.show()}navigator.splashscreen.hide();sController.app.events.params.dReady.resolve()},pgCheck:function(c){function b(d){sController.app.events.params.pg=d;sController.app.events.params.pgChk.resolve();setTimeout(function(){if(typeof c==="function"){c()}else{return d}},2)}if(document.location.protocol==="file:"){this.phoneGapListeners(function(){b(true)})}else{document.querySelector("#deviceready .pending").className+=" hide";var a=document.querySelector("#deviceready .complete");a.className=a.className.split("hide").join("");b(false)}},phoneGapListeners:function(c){try{window.addEventListener("message",sController.app.sysEvents.receiveMessage,false);window.addEventListener("onmessage",sController.app.sysEvents.receiveMessage,false);document.addEventListener("offline",sController.app.mobileEvents.onOffline,false);document.addEventListener("resume",sController.app.mobileEvents.onResume,false);document.addEventListener("start",sController.app.mobileEvents.onStart,true);document.addEventListener("pause",sController.app.mobileEvents.onPause,false);document.addEventListener("menubutton",sController.app.mobileEvents.menuButton,false);document.addEventListener("backbutton",sController.app.mobileEvents.backKey,false);document.addEventListener("orientationchange",sController.app.mobileEvents.orientChange,false);document.querySelector("#deviceready .pending").className+=" hide";var a=document.querySelector("#deviceready .complete");a.className=a.className.split("hide").join("")}catch(b){sUtil.clog("Error adding PhoneGap Listeners","init",true)}finally{c()}},hide:function(b){document.querySelector("#"+b+" .complete").className+=" hide";var a=document.querySelector("#"+b+" .pending");a.className=a.className.split("hide").join("")}},mobileEvents:{orientChange:function(){setTimeout(function(){},0)},onResume:function(){setTimeout(function(){},0)},onOffline:function(){setTimeout(function(){},0)},onPause:function(){setTimeout(function(){},0)},onStart:function(){setTimeout(function(){},0)},backKey:function(a){setTimeout(function(){a.preventDefault();sView.utils.confirm("Exit Swyft Mobile?","Notification","Yes","No",function(c){var b=(sModel.me.devicePlatform==="Android")?1:2;if(c===b){try{navigator.app.exitApp()}catch(d){sUtil.clog(d,"error",true)}}});return false},0)},menuButton:function(a){a.preventDefault();if(sModel.me.devicePlatform==="Android"){$("#mainP").panel("open")}}},sysEvents:{sInit:{start:function(){sController.app.sysEvents.sInit.createTbl.init(false,false)},createTbl:{s4:function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)},guid:function(){return sController.app.sysEvents.sInit.createTbl.s4()+sController.app.sysEvents.sInit.createTbl.s4()+"-"+sController.app.sysEvents.sInit.createTbl.s4()+"-"+sController.app.sysEvents.sInit.createTbl.s4()+"-"+sController.app.sysEvents.sInit.createTbl.s4()+"-"+sController.app.sysEvents.sInit.createTbl.s4()+sController.app.sysEvents.sInit.createTbl.s4()+sController.app.sysEvents.sInit.createTbl.s4()},init:function(j,k){sView.jqm.helpers.ldrWidget("show","Configuring Your Device");var e=new Date(),d=new Date(),g=null,i=null,c=null,a=null,h=null,f=null,b=null;if(sController.app.events.params.pg===true){sController.app.cfg.states[Connection.UNKNOWN]="Unknown connection";sController.app.cfg.states[Connection.ETHERNET]="Ethernet connection";sController.app.cfg.states[Connection.WIFI]="WiFi connection";sController.app.cfg.states[Connection.CELL_2G]="Cell 2G connection";sController.app.cfg.states[Connection.CEL_3G]="Cell 3G connection";sController.app.cfg.states[Connection.CELL_4G]="Cell 4G connection";sController.app.cfg.states[Connection.CELL]="Cell generic connection";sController.app.cfg.states[Connection.NONE]="No network connection";f=sController.app.cfg.states[navigator.connection.type];g=device.model;i=device.cordova;c=device.platform;a=sController.app.sysEvents.sInit.createTbl.guid();h=device.version}else{f="Ethernet Connection";g="N/A";i="N/A";c="Desktop";a=sController.app.sysEvents.sInit.createTbl.guid();h="N/A"}sModel.getLang(function(m){b=m;sController.app.cfg.usrTblObj={netState:f,results:null,deviceName:g,appVersion:sController.app.cfg.globalAppVersion,deviceCordova:i,devicePlatform:c,deviceGps:"true",deviceUuid:a,deviceVersion:h,deviceLat:"0",deviceLng:"0",initialized:"false",month:e.getMonth()+1,day:e.getDate(),year:e.getFullYear(),hours:d.getHours(),minutes:(d.getMinutes()<10)?"0"+d.getMinutes():d.getMinutes(),m:(d.getHours()>11)?"PM":"AM",gpsTimestamp:null,userId:$("#txtUIDWS").val().toLowerCase(),initializationKey:$("#txtInitKeyWS").val().toLowerCase(),mobileSiteUrl:null,mobileServicesUrl:null,brandingImageUrl:null,colorScheme:null,clientId:null,clientCode:null,interactionChannel:null,interactionType:null,interactionLocation:null,lang:b};sController.app.sysEvents.sInit.createTbl.sCreate(function(l){sController.app.cfg.usrTblObj={};if(l){sUtil.clog("usrTblObj Created");sModel.setObj(true,function(n){if(typeof j!=="undefined"&&j===true&&typeof k==="function"){k(true)}else{sController.app.sysEvents.sInit.stageOne()}})}else{sUtil.clog("User Table Not Created","config error",true);if(typeof j!=="undefined"&&j===true&&typeof k==="function"){k(false)}}})})},sCreate:function(a){sUtil.clog("Start Create","config");sController.app.sysEvents.sInit.createTbl.exSql(function(b){a(b)})},exSql:function(d){sUtil.clog("Ex SQL","config");var b=window.openDatabase("usrCfg","1.0","User Config",10000000),c=sController.app.cfg.usrTblObj.month+"/"+sController.app.cfg.usrTblObj.day+"/"+sController.app.cfg.usrTblObj.year,a=sController.app.cfg.usrTblObj.hours+":"+sController.app.cfg.usrTblObj.minutes+" "+sController.app.cfg.usrTblObj.m;b.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS usrCfg");e.executeSql("CREATE TABLE IF NOT EXISTS usrCfg (id unique, deviceName, appVersion, devicePlatform, deviceUuid, deviceVersion,  deviceCordova, initKey, userId, initialized, dateCreated, timeCreated, dateLastMod, timeLastMod, deviceGps, deviceLat, deviceLng, gpsTimestamp, netState, clientId, clientCode, mobileSiteUrl, mobileServicesUrl, brandingImageUrl, colorScheme, interactionChannel, interactionType, interactionLocation, lang)");e.executeSql('INSERT INTO usrCfg (id, deviceName, appVersion, devicePlatform, deviceUuid, deviceVersion,  deviceCordova,initKey, userId, initialized, dateCreated, timeCreated, dateLastMod, timeLastMod, deviceGps, deviceLat, deviceLng, gpsTimestamp, netState, clientId, clientCode, mobileSiteUrl, mobileServicesUrl, brandingImageUrl, colorScheme, interactionChannel, interactionType, interactionLocation, lang)VALUES (1, "'+sController.app.cfg.usrTblObj.deviceName+'", "'+sController.app.cfg.usrTblObj.appVersion+'", "'+sController.app.cfg.usrTblObj.devicePlatform+'", "'+sController.app.cfg.usrTblObj.deviceUuid+'", "'+sController.app.cfg.usrTblObj.deviceVersion+'","'+sController.app.cfg.usrTblObj.deviceCordova+'","'+sController.app.cfg.usrTblObj.initializationKey+'", "'+sController.app.cfg.usrTblObj.userId+'", "'+sController.app.cfg.usrTblObj.initialized+'", "'+c+'", "'+a+'", "'+c+'", "'+a+'", "'+sController.app.cfg.usrTblObj.deviceGps+'", "'+sController.app.cfg.usrTblObj.deviceLat+'", "'+sController.app.cfg.usrTblObj.deviceLng+'", "'+sController.app.cfg.usrTblObj.gpsTimestamp+'", "'+sController.app.cfg.usrTblObj.netState+'","'+sController.app.cfg.usrTblObj.clientId+'", "'+sController.app.cfg.usrTblObj.clientCode+'", "'+sController.app.cfg.usrTblObj.mobileSiteUrl+'", "'+sController.app.cfg.usrTblObj.mobileServicesUrl+'", "'+sController.app.cfg.usrTblObj.brandingImageUrl+'", "'+sController.app.cfg.usrTblObj.colorScheme+'","'+sController.app.cfg.usrTblObj.interactionChannel+'","'+sController.app.cfg.usrTblObj.interactionType+'","'+sController.app.cfg.usrTblObj.interactionLocation+'","'+sController.app.cfg.usrTblObj.lang+'")')},function(e){sUtil.clog(e,"config error",true);d(false)},function(){sUtil.clog("USER :: Table Created Successfully","Config");d(true)})}},stageOne:function(){sUtil.clog("Init Stage One");var f=null,c=null,k=window.openDatabase("usrCfg","1.0","User Config",10000000),d=null,i=null,a=null,g=null,l=null,h=null,e=null,j=null,b=null;$.support.cors=true;$.ajax({async:false,crossDomain:true,url:window.atob("aHR0cHM6Ly9tb2JpbGVjZW50cmFsLnN3eWZ0aHViLmNvbS9Td3lmdE1vYmlsZUNlbnRyYWwvQXV0aG9yaXphdGlvbi5hc214L0F1dGhvcml6ZVVzZXIy"),data:{DeviceID:sModel.me.deviceUuid,InitializationKey:$("#txtInitKeyWS").val().toLowerCase(),UserID:$("#txtUIDWS").val().toLowerCase(),AppVersion:sController.app.cfg.globalAppVersion},success:function(m){j=$(m).find("TransactionSuccess").text();b=$(m).find("Authorized").text();l=$(m).find("Severity").text();h=$(m).find("StackTrace").text();e=$(m).find("TransactionMessage").text();a=$(m).find("ClientID").text();g=$(m).find("ClientCode").text().toUpperCase();f=$(m).find("MobileSiteUrl").text();c=$(m).find("MobileServicesUrl").text();d=$(m).find("BrandingImageUrl").text();i=($(m).find("ColorScheme").text())?$(m).find("ColorScheme").text():"none";sUtil.clog("Stage 1 TX Success :: Auth is "+b,"init");if(b==="false"){sView.jqm.helpers.ldrWidget("hide");sView.utils.alert("Device Not Initialized!\nWrong User ID or Key!\n\nYour Device Has NOT Been Initialized!","Notification","I Understand",function(){sController.app.sysEvents.silentResetApp(sModel.me.deviceUuid)})}else{sUtil.clog("Device Ready to be Initialized","init");k.transaction(function(n){n.executeSql('UPDATE usrCfg SET clientId = "'+a+'", clientCode = "'+g+'", mobileSiteUrl = "'+f+'", mobileServicesUrl = "'+c+'", brandingImageUrl = "'+d+'", colorScheme = "'+i+'" WHERE id = 1')},function(n){sUtil.clog("First Init Call Error: "+n.message,"init",true)},function(){sModel.setObj(false,function(n){if(n){sController.app.sysEvents.sInit.stageTwo()}})})}}})},stageTwo:function(){sUtil.clog("Stage Two Start","init");$.ajax({async:false,crossDomain:true,url:sModel.me.mobileServicesUrl+"/SubmitMobileDeviceInfo",data:{ScreenWidth:window.innerWidth,DeviceType:sModel.me.devicePlatform,DeviceID:sModel.me.deviceUuid,DeviceOSVersion:sModel.me.deviceVersion,ScreenHeight:window.innerHeight,InteractionID:sModel.me.userId,ClientCode:sModel.me.clientCode},success:function(a){var b=$(a).find("TransactionSuccess").text();sUtil.clog("Stage 2 TX Success :: transres is "+b,"init");if(b==="false"){sView.utils.alert("Could Not Init Device!\nPlease Contact Swyft Support","Notification","I Understand",function(){throw"Init Error"})}else{sUtil.clog("Second Init Call Succeeded","init");sModel.setObj(false,function(c){if(c){sController.app.sysEvents.sInit.stageThree()}})}}})},stageThree:function(){sUtil.clog("Stage Three Start","init");var g,i=window.openDatabase("usrCfg","1.0","User Config",10000000),a,b,h,c,j,f,e,d;$.ajax({async:false,crossDomain:true,url:sModel.me.mobileServicesUrl+"/MobileAccessRestriction",data:{DeviceID:sModel.me.deviceUuid,InteractionID:sModel.me.userId,ClientCode:sModel.me.clientCode},success:function(k){g=$(k).find("TransactionSuccess").text();c=$(k).find("TransactionMessage").text();j=$(k).find("Severity").text();f=$(k).find("StackTrace").text();e=$(k).find("SiteAccessRestricted").text();d=$(k).find("DeviceActive").text();a=$(k).find("InteractionChannel").text().toUpperCase();b=$(k).find("InteractionType").text();h=$(k).find("InteractionLocation").text();sUtil.clog("Stage 3 TX Success :: transres is "+g,"init");if(g==="false"){sView.utils.alert("Could Not Init Device!\nPlease Contact Swyft Support","Notification","I Understand",function(){throw"Init Error"})}else{i.transaction(function(l){l.executeSql('UPDATE usrCfg SET interactionChannel = "'+a+'", interactionType = "'+b+'", interactionLocation = "'+h+'" WHERE id = 1')},function(l){sUtil.clog(l);return false},function(){sUtil.clog("All Done run cfgCheckSuccess","init",true);$("#txtUIDWS").val("");$("#txtInitKeyWS").val("");if(sModel.me.platform==="Android"&&sController.app.events.params.pg===true){try{window.plugins.Shortcut.CreateShortcut("Swyft",function(){sUtil.clog("Added icon to Home Screen")},function(){sUtil.clog("Failed adding icon to Home Screen")})}catch(l){sUtil.clog("Error")}}sModel.setObj(false,function(m){if(m){sController.app.sysEvents.cfgCheckSuccess()}else{sController.app.sysEvents.silentResetApp(sModel.me.deviceUuid)}})})}}})}},receiveMessage:function(a,p){if(typeof a==="undefined"||!a){sUtil.clog("REMOTE :: BLOCKED INBOUND REQUEST :: CRITICAL");return}var c=null,n=null,g=null,l=null,i=null,o=null;try{c=(typeof a.source!=="undefined")?a.source.location.host:false;o=(typeof a.origin!=="undefined")?a.origin:(typeof p!=="undefined")?p:false}catch(k){sUtil.clog("REMOTE :: BLOCKED INBOUND REQUEST 0 :: CRITICAL")}try{if(o==="file://"){if(a.data!=="undefined"){try{var h=JSON.parse(a.data);if(h.sw==="undefined"||h.sw!==window.atob("OUYxQzgwOTktNDY4RC00QTI3LThBRDUtRjJCQUM2MDBEQUQy")){sUtil.clog("REMOTE :: BLOCKED INBOUND REQUEST 1 :: CRITICAL");return}}catch(k){return}}else{return}}}catch(k){sUtil.clog("REMOTE :: BLOCKED INBOUND REQUEST 1 :: CRITICAL")}try{n=(c!==false)?c.split("."):(o!==false)?o.split("."):false;g=n[n.length-2];l=window.atob("OUYxQzgwOTktNDY4RC00QTI3LThBRDUtRjJCQUM2MDBEQUQy");i=(typeof a.data!=="undefined")?JSON.parse(a.data):JSON.parse(a)}catch(k){sUtil.clog("REMOTE :: BLOCKED INBOUND REQUEST 2 :: CRITICAL");return}if((g==="swyfthub"||g==="swyftmobile")&&window.atob(i.sw)===l){sUtil.clog("Message Received :: The Action is "+i.action,"remote",false);switch(i.action){case"appCheck":sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"openUrl":var j=(i.external)?i.external:false;sUtil.clog("REMOTE :: Opening URL :: External is "+j);if(i.actionItem.slice(-3)==="apk"){sView.openInapp(i.actionItem,false,true)}else{sView.openInapp(i.actionItem,false,j)}sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"getGps":sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,latitude:sModel.me.deviceLat,longitude:sModel.me.deviceLng,gpsTimeStamp:sModel.me.gpsTimestamp,sw:sController.app.events.params.spmk});break;case"queryGps":sModel.setGps(true,false,false,function(e){if(e===true){sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,latitude:sModel.me.deviceLat,longitude:sModel.me.deviceLng,gpsTimeStamp:sModel.me.gpsTimestamp,sw:sController.app.events.params.spmk})}else{sController.app.sysEvents.postMessage(a,{result:"fail",sw:sController.app.events.params.spmk})}});break;case"getPlatform":var f=$.Deferred();if(typeof sModel.me.devicePlatform==="undefined"){sModel.setObj(false,function(){f.resolve()})}else{f.resolve()}$.when(f).then(function(){sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,platform:sModel.me.devicePlatform,sw:sController.app.events.params.spmk})});break;case"getUsrCfg":sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,obj:sModel.me,sw:sController.app.events.params.spmk});break;case"panel":$("#mainP").panel(i.actionItem);sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"statusbar":if(i.actionItem==="hide"){StatusBar.hide()}else{if(i.actionItem==="show"){StatusBar.show()}}sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"changePage":if(i.actionItem==="info"){sView.changePage("info");setTimeout(function(){$("#diLastLoc").collapsible("expand")},100)}else{sView.changePage(i.actionItem)}sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"saveInteraction":if(typeof i.actionItem==="number"){sController.usr.saveInteraction(i.actionItem);sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk})}else{sController.app.sysEvents.postMessage(a,{result:"fail",action:i.action,sw:sController.app.events.params.spmk})}break;case"hideLoading":sView.jqm.helpers.ldrWidget("hide");$(".loadingCover").addClass("cssHide").removeClass("cssBlock");sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"clog":sUtil.clog("INNER APSX :: "+i.actionItem);sController.app.sysEvents.postMessage(a,{result:"success",action:i.action,sw:sController.app.events.params.spmk});break;case"menuData":var q=$(".assignmentsCount"),b=$(".followUpsCount"),d=i.cAssignments,m=i.cFollowUps;if(d!==""){q.html(d)}else{q.css("display","none")}if(m!==""){b.html(m)}else{b.css("display","none")}}}else{sUtil.clog("REMOTE :: BLOCKED INBOUND REQUEST 3 :: CRITICAL")}},postMessage:function(c,f,b){var a=(typeof b==="boolean")?b:false;if((typeof sView.socket!=="undefined"&&sView.socket!==null)||a===true){try{sView.socket.postMessage(JSON.stringify(f));sUtil.clog("Sent via XDM Message Socket :: Result was "+f.result,"Remote",false)}catch(d){if(typeof c.source!=="undefined"&&typeof c.source.postMessage==="function"){c.source.postMessage(JSON.stringify(f),c.origin);sUtil.clog("Send via HTML PostMessage :: Result was "+f.result,"Remote",false)}else{sUtil.clog("Post Message Failed","Remote",false)}}}else{try{c.source.postMessage(JSON.stringify(f),c.origin);sUtil.clog("Send via HTML PostMessage :: Result was "+f.result,"Remote",false)}catch(d){sUtil.clog("Post Message Failed","Remote",false)}}},innerAppRequest:function(b){var a=(sModel.me.platform==="Desktop")?true:false;sController.app.sysEvents.postMessage(false,{action:b,sw:sController.app.events.params.spmk},a)},getParameterByName:function(a,d){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),b=c.exec(location.search);d(b===null?"":decodeURIComponent(b[1].replace(/\+/g," ")))},resetApp:function(){sView.jqm.helpers.ldrWidget("show","Resetting App");sView.utils.confirm("This will reset Swyft on this device!","Notification","Sounds Good","No Stop",function(c){var a=(sModel.me.devicePlatform==="Android")?1:2;if(c===a){sController.app.events.hide("deviceready");var b=window.openDatabase("usrCfg","1.0","User Config",10000000);b.transaction(function(d){d.executeSql("DROP TABLE IF EXISTS usrCfg");d.executeSql("DROP TABLE IF EXISTS errLog")},function(d){sView.jqm.helpers.ldrWidget("hide");sUtil.clog(d)},function(){sView.utils.alert("Device Has Been Reset!","Notification","Thanks",function(){sView.changePage("welcomeSetup")})})}else{sView.jqm.helpers.ldrWidget("hide")}})},silentResetApp:function(b){if(b!==sModel.me.deviceUuid){return}sController.app.events.hide("deviceready");var a=window.openDatabase("usrCfg","1.0","User Config",10000000);a.transaction(function(c){c.executeSql("DROP TABLE IF EXISTS usrCfg");c.executeSql("DROP TABLE IF EXISTS errLog")},function(c){sUtil.clog(c);sView.changePage("welcomeSetup")},function(){sUtil.clog("Device Silently Reset");sView.changePage("welcomeSetup")})},cfgCheck:function(){sModel.setObj(true,function(){if(sModel.checkObj()){sController.app.sysEvents.cfgCheckSuccess()}else{sUtil.clog('User Data Model Corrupted :: Start "Welcome" Sequence',"core",false);sView.changePage("welcomeSetup")}})},cfgCheckSuccess:function(){sView.jqm.helpers.ldrWidget("show","Getting GPS Location");sUtil.clog("User Found","core",false);var b=$.Deferred();if(sModel.me.brandingImageUrl!==""||sModel.me.brandingImageUrl!==null||sModel.me.brandingImageUrl!==window.atob("aHR0cHM6Ly9tb2JpbGVkZW1vLnN3eWZ0aHViLmNvbS9tb2JpbGVicmFuZGluZy9zd3lmdG1vYmlsZS5wbmc=")){$(".mainLogo").attr("src",sModel.me.brandingImageUrl).enhanceWithin()}if(sModel.me.appVersion!==sController.app.cfg.globalAppVersion){var a=[{objId:"appVersion",val:sController.app.cfg.globalAppVersion}];sModel.tx(a,false)}sModel.setGps(true,true,true,function(c){if(c){b.resolve()}else{sUtil.clog("sModel.setGps was false");sView.utils.confirm("Could Not Configure GPS.\nPlease Contact Swyft Support","Notification","Proceed","Exit",function(e){var d=(sModel.me.devicePlatform==="Android")?1:2;if(e===d){sView.utils.alert("This Application is designed to work with GPS.\nMost functions will not work as expected!","Warning","I Understand",function(){sUtil.clog("SWYFT ::WARNING :: Entering With No GPS");var f=window.openDatabase("usrCfg","1.0","User Config",10000000);f.transaction(function(g){g.executeSql('UPDATE usrCfg SET deviceGps = "false",deviceLat  = "0", deviceLng  = "0", gpsTimestamp = "00/00/0000 00:00:00AM" WHERE id = 1')},sController.errorCB,function(){b.resolve()})})}else{sController.app.sysEvents.closeApp()}})}});$.when(b).then(function(){sController.app.sysEvents.startApp()})},startApp:function(){sUtil.clog("START APP","core",false);sView.jqm.helpers.ldrWidget("show","Logging In User");$("#txtModel").attr("value",sModel.me.deviceName);$("#txtSystem").attr("value",sModel.me.devicePlatform);$("#txtVersion").attr("value",sModel.me.deviceVersion);$("#txtAppVer").attr("value",sModel.me.appVersion);$("#netTypetxt").attr("value",sModel.me.netState);$("#gpsStatustxt").attr("value",(sModel.me.deviceGps)?"Yes":" Nope");$("#userIDtxt").attr("value",sModel.me.userId);sController.usr.maCheck(function(a,b){if(a!==true){sView.jqm.helpers.ldrWidget("hide");sView.utils.alert(b+"\nContact Swyft Support","Notification","I Understand",function(){sUtil.clog("Login Failed","login error",true)})}else{sView.jqm.helpers.ldrWidget("show","Loading Dashboard");sController.usr.saveInteraction(600,function(){sView.changePage("dash")})}},true)},closeApp:function(){sView.jqm.helpers.ldrWidget("hide");if(sController.app.events.params.pg===true){navigator.app.closeApp()}}}},forms:{params:{hasSig:false,theSig:false},validate:function(c){var f=c,e=false;if($(".captureSig").length>0){$(".sigPad").signaturePad({drawOnly:true,lineTop:55,validateFields:false});sController.forms.params.hasSig=true}var b,a,d;d={};d.reqFields=[];if(sController.forms.params.hasSig===true){a=$(".sigPad").signaturePad().validateForm();if(a===true){sController.forms.params.theSig=true}else{sController.forms.params.theSig=false}}$("#"+f+" .reqInput").each(function(n,s){var i=s.id;var m=s.value;var r=s.type;var l=s.selectedIndex;if(l>=0){r="selectList"}switch(r){case"selectList":if(l===0){var j={id:i,type:"selectList",value:m};d.reqFields.push(j)}else{$("select#"+i).parent().attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a")}break;case"checkbox":if($(this).is(":not(:checked)")){var h={id:i,type:r,value:m};d.reqFields.push(h)}else{$("label[for='"+i+"'] ").attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a")}break;case"text":case"textarea":if(m===""||m==="Required"||m===null){var g={id:i,type:r,value:m};d.reqFields.push(g)}else{$("input#"+i).parent().removeClass("isReq").addClass("reset");$("input#"+i).removeClass("isReqTxt").attr("onfocus","").attr("onblur","");$("#"+i).parents("div.ui-input-datebox").removeClass("isReq")}break;case"fieldset":var p=$("#"+i+' input[type="checkbox"]').length;var o=$("#"+i+' input[type="radio"]').length;var k=false;if(p>0){$("#"+i+' input[type="checkbox"]').each(function(){if(s.checked){k=true}})}else{if(o>0){$("#"+i+' input[type="radio"]').each(function(){if(s.checked){k=true}})}}if(k===false){var t={id:i,type:r,value:m};d.reqFields.push(t)}else{var q;if(p>0){q=$("#"+i+' input[type="checkbox"]')}else{if(o>0){q=$("#"+i+' input[type="radio"]')}}$.each(q,function(u){var w=u.id;$('label[for="'+w+'"]').attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a")})}break;case"undefined":break;case"":break}});b=d.reqFields.length;if(b===0&&(sController.forms.params.hasSig===false||(sController.forms.params.hasSig===true&&sController.forms.params.theSig===true))){e=true}else{sView.utils.alert("Please Check All Fields","Notification","Will Do",function(){$.each(d.reqFields,function(i,k){var j=k.type;var m=k.id;switch(j){case"fieldset":var g=$("#"+m+' input[type="checkbox"]').length;var l=$("#"+m+' input[type="radio"]').length;var h=0;if(g>0){h=$("#"+m+' input[type="checkbox"]')}else{if(l>0){h=$("#"+m+' input[type="radio"]')}}$.each(h,function(n){var o=n.id;$('label[for="'+o+'"]').attr("data-theme","b").removeClass("ui-btn-up-a").addClass("ui-btn-up-b")});break;case"selectList":$("select#"+m).parent().attr("data-theme","b").removeClass("ui-btn-up-a").addClass("ui-btn-up-b");break;case"checkbox":$('label[for="'+m+'"] ').attr("data-theme","b").removeClass("ui-btn-up-a").addClass("ui-btn-up-b");break;case"textarea":case"text":$("input#"+m).attr("placeholder","").attr("value","Required").attr("onfocus","if(this.value === 'Required') {this.value=''}").attr("onblur","if(this.value === ''){this.value ='Required'}").addClass("isReq").textinput("refresh");break;case"":break;case"undefined":break}})})}if(!e){return false}else{return true}},clear:function(a){$(".valErrorMsg_"+a).css("display","none");if($(".captureSig").length>0){$(".sigPad").signaturePad().clearCanvas();$(".error").css("display","none")}$("#"+a+" .reqInput").each(function(d,f){var h=f.id;var e=f.type;var b=f.selectedIndex;if(b>=0){e="selectList"}switch(e){case"fieldset":var c=$("#"+h+' input[type="checkbox"]').length;var g=$("#"+h+' input[type="radio"]').length;if(c>0){$("#"+h+' input[type="checkbox"]').each(function(i){var k=i.id;var j=$(this).attr("checked");$('label[for="'+k+'"]').attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");if(j){$(this).attr("checked",false).checkboxradio("refresh")}})}else{if(g>0){$("#"+h+' input[type="radio"]').each(function(i){var k=i.id;var j=$(this).attr("checked");$('label[for="'+k+'"]').attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");if(j){$(this).attr("checked",false).checkboxradio("refresh")}})}}break;case"selectList":if(b!=="0"||b!==null||b!==""){$("select#"+h).attr("selectedIndex","0")}$("select#"+h).parent().attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");break;case"checkbox":$("[for="+h+"]").attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");$("#"+h).attr("checked",false).checkboxradio("refresh");break;case"radio":$("#[for="+h+"]").attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a");$("#"+h+' input[type="radio":checked]').each(function(){$(this).checked=false});break;case"text":if(h==="txtUIDWS"){$("input#"+h).attr("placeholder","User ID")}else{if(h==="txtInitKeyWS"){$("input#"+h).attr("placeholder","Initialization Key")}else{$("input#"+h).attr("placeholder","")}}$("input#"+h).parent().addClass("reset").removeClass("isReq");$("input#"+h).val("").css("color","#ffffff").attr("onfocus","").attr("onblur","");break;case"date":$("#"+h).attr("data-theme","a").removeClass("ui-btn-up-b").addClass("ui-btn-up-a").val("").removeClass("isReq").css("color","#ffffff");break;case"undefined":break;case"":break;case"password":case"select-multiple":case"select-one":case"textarea":$("input#"+h).parent().addClass("reset").removeClass("isReq");$("input#"+h).val("").css("color","#ffffff").attr("onfocus","").attr("onblur","");break}})}},usr:{params:{cbHolder:false},maCheck:function(h,d){var f=null,a=null,c=null,b=null,e=null,g=null;sUtil.clog(sModel.me.mobileServicesUrl+"/MobileAccessRestriction?deviceid="+sModel.me.deviceUuid+"&userid="+sModel.me.userId+"&clientcode="+sModel.me.clientCode);$.ajax({crossDomain:true,url:sModel.me.mobileServicesUrl+"/MobileAccessRestriction",async:false,data:{DeviceID:sModel.me.deviceUuid,InteractionID:sModel.me.userId,ClientCode:sModel.me.clientCode},success:function(j){f=$(j).find("SiteAccessRestricted").text();a=$(j).find("ValidCredentials").text();c=$(j).find("DeviceActive").text();b=$(j).find("InteractionChannel").text();e=$(j).find("InteractionType").text();g=$(j).find("InteractionLocation").text();var i=[{objId:"interactionChannel",val:b},{objId:"interactionType",val:e},{objId:"interactionLocation",val:g}];sModel.tx(i,function(){if(c==="true"&&a==="true"){sUtil.clog("ValidCredentials & DeviceActive","login",false);sController.usr.sInfoUpdate(function(){h(true,"User Logged In")})}else{if(a==="false"){sUtil.clog("ValidCredentials = false","login",false);h(false,"Non-Valid Credentials")}else{if(c==="false"){sUtil.clog("DeviceActive = false","login",true);h(false,"Device Inactive")}else{sUtil.clog("Unknown Status","login",false);h(false,"Login Blocked")}}}})},error:function(i){sUtil.clog("User Not Logged In! "+i.message,"login error",true);h(false,"SWYFT :: Error "+i.message)}})},sInfoUpdate:function(c){sUtil.clog("Starting Update Calls","sInfo Update",false);function a(d){sModel.setObj(false,function(e){if(d==="notAuth"){sView.changePage("loading")}else{sController.usr.sInfoUpdateSwyft()}})}var b=$.Deferred;sController.usr.params.cbHolder=(typeof c==="function")?c:false;$.ajax({crossDomain:true,url:window.atob("aHR0cHM6Ly9tb2JpbGVjZW50cmFsLnN3eWZ0aHViLmNvbS9Td3lmdE1vYmlsZUNlbnRyYWwvQXV0aG9yaXphdGlvbi5hc214L0F1dGhvcml6ZVVzZXIy"),data:{DeviceID:sModel.me.deviceUuid,InitializationKey:sModel.me.initKey,UserID:sModel.me.userId,AppVersion:sController.app.cfg.globalAppVersion},success:function(e){if($(e).find("Authorized").text()==="false"){sUtil.clog("DEVICE OR USER NOT AUTHORIZED","sInfo Update",true);a("notAuth")}else{if($(e).find("Authorized").text()==="true"){var d=[{objId:"appVersion",val:sController.app.cfg.globalAppVersion},{objId:"clientId",val:$(e).find("ClientID").text()},{objId:"clientCode",val:$(e).find("ClientCode").text().toUpperCase()},{objId:"mobileServicesUrl",val:$(e).find("MobileServicesUrl").text()},{objId:"mobileSiteUrl",val:$(e).find("MobileSiteUrl").text()},{objId:"brandingImageUrl",val:$(e).find("BrandingImageUrl").text()},{objId:"colorScheme",val:($(e).find("colorScheme").text())?$(e).find("colorScheme").text():"none"}];sModel.tx(d,function(f,g){if(f){sUtil.clog("User Info NOT Updated TX Error","sInfo Update",true);a(false)}else{a(true)}})}else{sUtil.clog("User Info NOT Updated: Authorized was not True","sInfo Update",true);a(false)}}}}).error(function(){sUtil.clog("User Info NOT Updated, Call Failed","sInfo Update",true);a(false)})},sInfoUpdateSwyft:function(){var a=(typeof sController.usr.params.cbHolder==="function")?sController.usr.params.cbHolder:false;sController.usr.params.cbHolder=false;$.ajax({crossDomain:true,url:sModel.me.mobileServicesUrl+"/SubmitMobileDeviceInfo",data:{ScreenWidth:window.innerWidth,DeviceType:sModel.me.devicePlatform,DeviceID:sModel.me.deviceUuid,DeviceOSVersion:sModel.me.deviceVersion,ScreenHeight:window.innerHeight,InteractionID:sModel.me.userId,ClientCode:sModel.me.clientCode},success:function(b){if($(b).find("TransactionSuccess").text()!=="true"){sUtil.clog("sInfoUpdateUser NOT Info Updated","sInfo Update",false);if(a!==false){a()}}else{sUtil.clog("User Info Updated","sInfo Update",false);if(a!==false){a()}}}})},saveInteraction:function(b,d){function c(){if(typeof d==="function"){d()}}var a=$.Deferred();if(typeof b!=="undefined"&&typeof b==="number"){$.ajax({crossDomain:true,url:sModel.me.mobileServicesUrl+"/SaveInteraction3",data:{DeviceID:sModel.me.deviceUuid,InteractionLongitude:sModel.me.deviceLng,InteractionLatitude:sModel.me.deviceLat,InteractionType:sModel.me.interactionType,InteractionChannel:sModel.me.interactionChannel,InteractionID:sModel.me.userId,InteractionLocation:sModel.me.interactionLocation,InteractionResult:b,InteractionReason:-1,InteractionResultReason:-1,ClientCode:sModel.me.clientCode},success:function(e){if($(e).find("TransactionSuccess").text()==="true"){sUtil.clog("Saved Interaction | Code: "+b,"save interaction",false)}else{sUtil.clog("Interaction Save FAILED : TransactionSuccess Was not True","save interaction",true)}a.resolve()}}).error(function(){sUtil.clog("Interaction Save FAILED : AJAX Call Failed","save interaction",true);a.resolve()})}else{sUtil.clog("Interaction Save FAILED : No Code Passed in","save interaction",true);a.resolve()}$.when(a).then(function(){c()})}},debug:{getStatus:function(){return(window.localStorage.getItem("debug"))?window.localStorage.getItem("debug"):false},getId:function(){return(window.localStorage.getItem("debugId"))?window.localStorage.getItem("debugId"):false},setStatus:function(a,b){if(a===true){window.localStorage.setItem("debug",a);window.localStorage.setItem("debugId",sController.genRandomNum());if(typeof b==="function"){b(this.debug.getId())}}else{if(a===false){window.localStorage.removeItem("debugId");window.localStorage.removeItem("debug")}}}}};sController.app.sysEvents.getParameterByName("init",function(a){if(typeof a!=="undefined"&&a!==false&&a!=="false"&&a!==null){sController.app.initialize()}});